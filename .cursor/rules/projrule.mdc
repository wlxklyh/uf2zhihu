---
alwaysApply: true
---

# YouTube转文章工具 - 项目规则

## 项目概述
将 YouTube 视频转换为带截图的文章，支持 Web 界面操作。
- Python 3.8+
- 需要 yt-dlp, whisper, ffmpeg 等依赖

## 关键编码规范

### ⚠️ Windows GBK 编码兼容性
**问题：** 日志中的 emoji 导致 Windows 环境 `UnicodeEncodeError`
**解决：** 禁止使用 emoji，使用文本标记如 `[检查]` `[成功]` `[错误]`

## 已知问题
1. **Windows GBK 编码与 Emoji 冲突** - 已通过文本标记替代解决
2. **回调函数初始化** - 已在 `__init__` 中统一初始化

## 开发注意事项
- 跨平台兼容性（Windows/Linux）
- 使用 `os.path` 处理路径
- 避免 emoji 和特殊 Unicode 字符
- 确保资源正确释放

## Git工作流规范

### 分支策略
- **主干开发**：所有开发直接在 `main` 分支进行
- **无需创建功能分支**：简化工作流，避免分支管理复杂度

### 提交流程
标准的三步提交流程：

1. **添加更改**
   ```bash
   git add .
   ```

2. **提交更改**
   ```bash
   git commit -m "描述性的提交信息"
   ```

3. **推送到远程**
   ```bash
   git push origin main
   ```

### 提交信息规范
- 使用清晰的描述性信息
- 建议格式：`类型: 简短描述`
- 常用类型：`feat`(新功能)、`fix`(修复)、`docs`(文档)、`refactor`(重构)

## 集成测试规范

### 测试前准备（必须执行）
1. **清理缓存**：删除 `cache/` 目录下所有文件
   ```powershell
   Remove-Item -Path "cache\*" -Recurse -Force
   ```

2. **清理日志**：删除 `logs/` 目录下的日志文件（如果被占用则忽略）
   ```powershell
   Remove-Item -Path "logs\*.log" -Force -ErrorAction SilentlyContinue
   ```

3. **清理项目**：删除 `projects/` 目录下的所有测试项目
   ```powershell
   Remove-Item -Path "projects\*" -Recurse -Force
   ```

4. **清理进程**：停止所有相关Python进程
   ```powershell
   Stop-Process -Name "python","py" -Force -ErrorAction SilentlyContinue
   ```

### 测试环境要求
- ✅ **必须使用**：Cursor IDE 内置浏览器进行测试
- ❌ **禁止使用**：外部浏览器（Chrome、Firefox、Edge等）
- **原因**：确保测试在统一环境中进行，避免环境差异导致的问题

### 测试流程
1. 执行上述清理命令
2. 启动Web服务器（后台运行）
3. 使用Cursor内置浏览器访问 `http://localhost:5000`
4. 完成功能测试
5. 验证进度显示、日志输出等功能
6. 测试完成后停止服务器

### 测试验证要点
- 下载进度UI显示（百分比、速度、ETA）
- WebSocket消息传输正常
- 日志无GBK编码错误
- 所有步骤顺序执行
